import numpy as np
import pandas as pd
# numpyæ˜¯Pythonä¸­ç”¨äºç§‘å­¦è®¡ç®—çš„åº“ï¼Œpandasæ˜¯Pythonä¸­ç”¨äºæ•°æ®åˆ†æå’Œå¤„ç†çš„åº“ã€‚
# numpyæä¾›äº†å¤§é‡çš„æ•°å­¦å‡½æ•°ï¼Œå¯ä»¥ç”¨äºæ•°ç»„ã€çŸ©é˜µã€å‘é‡ç­‰æ•°å­¦è¿ç®—ã€‚
# pandasæä¾›äº†æ•°æ®æ¡†ã€æ•°æ®ç³»åˆ—ç­‰æ•°æ®ç»“æ„ï¼Œå¯ä»¥ç”¨äºæ•°æ®åˆ†æå’Œå¤„ç†ã€‚


data = np.random.standard_normal((1000000,2)) # ç”Ÿæˆ1000000è¡Œ2åˆ—çš„éšæœºæ•°,æ ‡å‡†æ­£æ€åˆ†å¸ƒ,å‡å€¼ä¸º0,æ ‡å‡†å·®ä¸º1,
                                    # standard_normal å‡½æ•°è¿”å›ä¸€ä¸ªæˆ–ä¸€ç»„æ ·æœ¬ï¼Œå…·æœ‰æ ‡å‡†æ­£æ€åˆ†å¸ƒã€‚
print(data.nbytes) # å­—èŠ‚å¤§å°, 1000000*2*8=16MB, nbytesæ˜¯numpyæ•°ç»„çš„ä¸€ä¸ªå±æ€§ï¼Œç”¨äºè·å–æ•°ç»„ä¸­å…ƒç´ å ç”¨çš„å­—èŠ‚æ•°ã€‚
                        # è¾“å‡º16MBæ˜¯å› ä¸ºï¼Œæ¯ä¸ªæµ®ç‚¹æ•°å ç”¨8ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥1000000*2*8=16MBã€‚
df = pd.DataFrame(data, columns=['x', 'y'])
print() # ç©ºè¡Œ

print(df.info()) # æ˜¾ç¤ºæ•°æ®æ¡†çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¡Œæ•°ã€åˆ—æ•°ã€æ•°æ®ç±»å‹ã€å†…å­˜ä½¿ç”¨æƒ…å†µç­‰ã€‚

''' è¾“å‡ºï¼š
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 1000000 entries, 0 to 999999     # entriesè¡¨ç¤ºè¡Œæ•°,ä»0åˆ°999999,å…±æœ‰1000000è¡Œ,0 to 999999è¡¨ç¤ºç´¢å¼•èŒƒå›´
Data columns (total 2 columns):
 #   Column  Non-Null Count    Dtype  
---  ------  --------------    -----  
 0   x       1000000 non-null  float64
 1   y       1000000 non-null  float64
dtypes: float64(2)                           # æ•°æ®ç±»å‹ä¸ºfloat64,å…±æœ‰2åˆ—
memory usage: 15.3 MB
None                                         # Noneè¡¨ç¤ºæ²¡æœ‰æ›´å¤šçš„è¾“å‡º
'''
print() 
# ğŸ‘‡åŸä¹¦ä»£ç ç‰ˆæœ¬è€æ—§ï¼Œä¸‹é¢æœ‰æ–°çš„ï¼š
# %time res = df['x'] + df['y'] # %timeè¡¨ç¤ºè®¡ç®—ä»£ç è¿è¡Œæ—¶é—´, resè¡¨ç¤ºç»“æœ
print()

# æ–°ç‰ˆæœ¬ä»£ç ï¼š

import time # å¯¼å…¥timeæ¨¡å—ï¼Œç”¨äºè®¡ç®—ä»£ç è¿è¡Œæ—¶é—´

start = time.time()      # è·å–å½“å‰æ—¶é—´ï¼Œç”¨äºè®¡ç®—ä»£ç è¿è¡Œæ—¶é—´ï¼Œstartè¡¨ç¤ºå¼€å§‹æ—¶é—´
res = df['x'] + df['y']  # è®¡ç®—xåˆ—å’Œyåˆ—çš„å’Œï¼Œresè¡¨ç¤ºç»“æœ
end = time.time()        # è·å–å½“å‰æ—¶é—´ï¼Œç”¨äºè®¡ç®—ä»£ç è¿è¡Œæ—¶é—´ï¼Œ endè¡¨ç¤ºç»“æŸæ—¶é—´

# ğŸ‘† åŸä¹¦æç¤ºï¼šdf['x'] + df['y'] ï¼šç›´æ¥ä½¿ç”¨åˆ—ï¼ˆSerieså¯¹è±¡ï¼‰æ˜¯æœ€å¿«çš„æ–¹æ³•ï¼Œå› ä¸ºpandasä¼šè‡ªåŠ¨ä¼˜åŒ–è®¡ç®—ã€‚

print(f"è€—æ—¶ {end - start:.6f} ç§’") # è¾“å‡ºä»£ç è¿è¡Œæ—¶é—´ï¼Œ:.6fè¡¨ç¤ºä¿ç•™6ä½å°æ•°ï¼Œend - startè¡¨ç¤ºä»£ç è¿è¡Œæ—¶é—´ï¼Œå•ä½ä¸ºç§’ã€‚
# è¾“å‡ºï¼š
# è€—æ—¶ 0.016638 ç§’

print()

# ğŸ‘‡åŸä¹¦ä»£ç ç‰ˆæœ¬è€æ—§ï¼Œä¸‹é¢æœ‰æ–°çš„ï¼š
# %time res = df.sum(axis= 1) # axis=1è¡¨ç¤ºæŒ‰è¡Œæ±‚å’Œï¼Œresè¡¨ç¤ºç»“æœ,sumå‡½æ•°æ˜¯pandasæ•°æ®æ¡†çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºè®¡ç®—æ•°æ®æ¡†ä¸­æ‰€æœ‰å…ƒç´ çš„å’Œã€‚

# æ–°ç‰ˆæœ¬ä»£ç ï¼š 
start = time.time()
res = df.sum(axis=1) # axisæ„æ€æ˜¯è½´ï¼Œaxis=1è¡¨ç¤ºæŒ‰è¡Œæ±‚å’Œï¼Œresè¡¨ç¤ºç»“æœ
end = time.time()

# ğŸ‘† åŸä¹¦æç¤ºï¼šè°ƒç”¨DataFrameå¯¹è±¡çš„sumæ–¹æ³•æ¥è®¡ç®—æ€»å’Œ

print(f"è€—æ—¶ {end - start:.6f} ç§’")
# è¾“å‡ºï¼š
# è€—æ—¶ 0.016638 ç§’
print()

start = time.time()
res = df.values.sum(axis=1) # valueså±æ€§å°†æ•°æ®æ¡†è½¬æ¢ä¸ºnumpyæ•°ç»„ï¼Œaxis=1è¡¨ç¤ºæŒ‰è¡Œæ±‚å’Œï¼Œresè¡¨ç¤ºç»“æœ
end = time.time()
# ğŸ‘† åŸä¹¦æç¤ºï¼šå°†DataFrameå¯¹è±¡è½¬æ¢ä¸ºNumPyæ•°ç»„ï¼ˆè°ƒç”¨ndarrayå¯¹è±¡çš„sumæ–¹æ³•ï¼‰ï¼Œç„¶åä½¿ç”¨sumå‡½æ•°æ¥è®¡ç®—æ€»å’Œï¼Œaiæç¤ºï¼šè¿™ä¼šé€è¡Œæ±‚å’Œï¼Œå› æ­¤é€Ÿåº¦è¾ƒæ…¢ã€‚

print(f"è€—æ—¶ {end - start:.6f} ç§’")
# è¾“å‡ºï¼š
# è€—æ—¶ 0.016638 ç§’

print()

print(res) # è¾“å‡ºç»“æœ,resæ˜¯ä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼ŒåŒ…å«æ•°æ®æ¡†ä¸­æ‰€æœ‰å…ƒç´ çš„å’Œã€‚
print()

print(res[:3]) # è¾“å‡ºå‰3è¡Œæ•°æ®
print()

# ğŸ‘‡åŸä¹¦ä»£ç ç‰ˆæœ¬è€æ—§ï¼Œä¸‹é¢æœ‰æ–°çš„ï¼š
#%time res = np.sum(df, axis=1) # axis=1è¡¨ç¤ºæŒ‰è¡Œæ±‚å’Œï¼Œresè¡¨ç¤ºç»“æœ

# æ–°ç‰ˆæœ¬ä»£ç ï¼š
start = time.time()
res = np.sum(df, axis=1)    # axis=1è¡¨ç¤ºæŒ‰è¡Œæ±‚å’Œï¼Œresè¡¨ç¤ºç»“æœ,
                            # sum(df, axis=1)è¡¨ç¤ºè®¡ç®—æ•°æ®æ¡†dfä¸­æ‰€æœ‰å…ƒç´ çš„å’Œï¼Œaxis=1è¡¨ç¤ºæŒ‰è¡Œæ±‚å’Œ
end = time.time()

# ğŸ‘† åŸä¹¦ï¼šè°ƒç”¨DstaFrameå¯¹è±¡çš„np.sumæ–¹æ³•æ¥è®¡ç®—æ€»å’Œ
print(f"è€—æ—¶ {end - start:.6f} ç§’")
print()

print(res[:3]) # è¾“å‡ºå‰3è¡Œæ•°æ®

# ğŸ‘‡åŸä¹¦ä»£ç ç‰ˆæœ¬è€æ—§ï¼Œä¸‹é¢æœ‰æ–°çš„ï¼š
# %time res = np.sum(df.values, axis=1) # valueså±æ€§å°†æ•°æ®æ¡†è½¬æ¢ä¸ºnumpyæ•°ç»„ï¼Œaxis=1è¡¨ç¤ºæŒ‰è¡Œæ±‚å’Œï¼Œresè¡¨ç¤ºç»“æœ

# æ–°ç‰ˆæœ¬ä»£ç ï¼š
start = time.time()
res = np.sum(df.values, axis=1) # valueså±æ€§å°†æ•°æ®æ¡†è½¬æ¢ä¸ºnumpyæ•°ç»„ï¼Œaxis=1è¡¨ç¤ºæŒ‰è¡Œæ±‚å’Œï¼Œresè¡¨ç¤ºç»“æœ
    # numpyæ•°ç»„å’Œdataframeæ•°ç»„çš„åŒºåˆ«åœ¨äºï¼Œnumpyæ•°ç»„åªèƒ½å­˜å‚¨ä¸€ç§ç±»å‹çš„æ•°æ®ï¼Œè€Œdataframeæ•°ç»„å¯ä»¥å­˜å‚¨å¤šç§ç±»å‹çš„æ•°æ®ã€‚
    # å°†æ•°æ®æ¡†è½¬æ¢ä¸ºnumpyæ•°ç»„çš„åŸå› æ˜¯ï¼Œnumpyæ•°ç»„çš„è®¡ç®—é€Ÿåº¦æ¯”dataframeæ•°ç»„å¿«ã€‚

# ğŸ‘† åŸä¹¦ï¼šè°ƒç”¨ndarrayå¯¹è±¡çš„np.sumæ–¹æ³•æ¥è®¡ç®—æ€»å’Œ
print(f"è€—æ—¶ {end - start:.6f} ç§’")

print()

print(res[:3]) # è¾“å‡ºå‰3è¡Œæ•°æ®

# serieså¯¹è±¡ï¼š
# serieså¯¹è±¡æ˜¯pandasæ•°æ®æ¡†çš„ä¸€ä¸ªå­é›†ï¼Œå¯ä»¥ç”¨äºå­˜å‚¨ä¸€ç»´æ•°æ®ã€‚
# serieså¯¹è±¡çš„ç´¢å¼•å¯ä»¥ç”¨äºè®¿é—®æ•°æ®ï¼Œç´¢å¼•å¯ä»¥æ˜¯æ•´æ•°ã€å­—ç¬¦ä¸²ã€å¸ƒå°”å€¼ç­‰ã€‚
# serieså¯¹è±¡çš„å€¼å¯ä»¥ç”¨äºè®¡ç®—ï¼Œä¾‹å¦‚æ±‚å’Œã€æ±‚å¹³å‡å€¼ã€æ±‚æœ€å¤§å€¼ã€æ±‚æœ€å°å€¼ç­‰ã€‚
# serieså¯¹è±¡çš„ç´¢å¼•å¯ä»¥ç”¨äºä¿®æ”¹æ•°æ®ã€åˆ é™¤æ•°æ®ã€æ·»åŠ ã€æ’åºã€åˆ†ç»„ã€ç­›é€‰ã€åˆå¹¶ã€åˆ†å‰²ã€è½¬æ¢ã€
# è®¡ç®—ã€å¯è§†åŒ–ã€å­˜å‚¨ã€è¯»å–ã€å†™å…¥ã€æŸ¥è¯¢ã€æ›´æ–°ç­‰ã€‚
# serieså¯¹è±¡çš„ç´¢å¼•å¯ä»¥ç”¨äºåˆ é™¤æ•°æ®ï¼Œä¾‹å¦‚åˆ é™¤æŸä¸ªç´¢å¼•å¯¹åº”çš„å€¼ã€åˆ é™¤æŸä¸ªç´¢å¼•å¯¹åº”çš„å€¼ç­‰ã€‚
# serieså¯¹è±¡çš„ç´¢å¼•å¯ä»¥ç”¨äºæ·»åŠ æ•°æ®ï¼Œä¾‹å¦‚æ·»åŠ æŸä¸ªç´¢å¼•å¯¹åº”çš„å€¼ã€æ·»åŠ æŸä¸ªç´¢å¼•å¯¹åº”çš„å€¼ç­‰ã€‚
# serieså¯¹è±¡çš„ç´¢å¼•å¯ä»¥ç”¨äºæ’åºæ•°æ®ï¼Œä¾‹å¦‚æŒ‰å€¼æ’åºã€æŒ‰ç´¢å¼•æ’åºç­‰ã€‚

# ğŸ‘‡åŸä¹¦ä»£ç ç‰ˆæœ¬è€æ—§ï¼Œä¸‹é¢æœ‰æ–°çš„ï¼š
# %time res = df.eval('x + y') # evalå‡½æ•°æ˜¯pandasæ•°æ®æ¡†çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºè®¡ç®—æ•°æ®æ¡†ä¸­è¡¨è¾¾å¼çš„å€¼ï¼Œresè¡¨ç¤ºç»“æœ

# æ–°ç‰ˆæœ¬ä»£ç ï¼š
start = time.time()
res = df.eval('x + y') # evalå‡½æ•°æ˜¯pandasæ•°æ®æ¡†çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºè®¡ç®—æ•°æ®æ¡†ä¸­è¡¨è¾¾å¼çš„å€¼ï¼Œresè¡¨ç¤ºç»“æœ
end = time.time()

print(f"è€—æ—¶ {end - start:.6f} ç§’")
print()

print(res[:3]) # è¾“å‡ºå‰3è¡Œæ•°æ®
print()

# ğŸ‘‡åŸä¹¦ä»£ç ç‰ˆæœ¬è€æ—§ï¼Œä¸‹é¢æœ‰æ–°çš„
# %time res = df.apply(lambda row: row['x'] + row['y'], axis=1) 
# applyå‡½æ•°æ˜¯pandasæ•°æ®æ¡†çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºåº”ç”¨å‡½æ•°åˆ°æ•°æ®æ¡†çš„æ¯ä¸€è¡Œæˆ–æ¯ä¸€åˆ—ï¼Œresè¡¨ç¤ºç»“æœ

# âš ï¸ æœ€æ…¢çš„æ–¹æ³•æ˜¯é€è¡Œä½¿ç”¨applyå‡½æ•°ï¼Œå› ä¸ºapplyå‡½æ•°ä¼šé€è¡Œè°ƒç”¨lambdaå‡½æ•°ï¼Œè€Œlambdaå‡½æ•°ä¼šé€è¡Œè®¡ç®—xåˆ—å’Œyåˆ—çš„å’Œã€‚

# æ–°ç‰ˆæœ¬ä»£ç ï¼š
start = time.time()
res = df.apply(lambda row: row['x'] + row['y'], axis=1) 
        # applyå‡½æ•°æ˜¯pandasæ•°æ®æ¡†çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºåº”ç”¨å‡½æ•°åˆ°æ•°æ®æ¡†çš„æ¯ä¸€è¡Œæˆ–æ¯ä¸€åˆ—
        # lambdaå‡½æ•°æ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œ
        # rowè¡¨ç¤ºæ¯ä¸€è¡Œï¼Œrow['x']è¡¨ç¤ºæ¯ä¸€è¡Œçš„xåˆ—row['y']è¡¨ç¤ºæ¯ä¸€è¡Œçš„yåˆ—ï¼Œrow['x'] + row['y']è¡¨ç¤ºæ¯ä¸€è¡Œçš„xåˆ—å’Œyåˆ—çš„å’Œ
        # axis=1è¡¨ç¤ºæŒ‰è¡Œåº”ç”¨å‡½æ•°
end = time.time()

print(f"è€—æ—¶ {end - start:.6f} ç§’")
print()

print(res[:3]) # è¾“å‡ºå‰3è¡Œæ•°æ®