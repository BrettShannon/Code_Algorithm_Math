import math
import numpy as np

# 初始股票指数水平S0 = 100
# 欧式看涨期权的行权价格K = 105
# 到期时间T = 1年
# 固定无风险短期利率r = 5%
# 固定波动率σ = 20%

S0 = 100. # 初始股票指数水平
K= 105. # 欧式看涨期权的行权价格
T = 1.0 # 到期时间
r = 0.05 # 固定无风险短期利率
sigma = 0.2 # 固定波动率σ

I = 100000  #模拟次数

np.random.seed(1000)  # 设置随机种子，保证结果可复现
z = np.random.standard_normal(I) # 生成10万个随机数（模拟市场不确定性）

ST = S0 * np.exp((r - sigma ** 2 / 2) * T + sigma * math.sqrt(T) * z) 
                # 计算到期时的股票指数水平, 公式解读：
                # (r - sigma ** 2 / 2) * T：股价长期趋势（利率影响 - 波动率调整）
                # sigma * math.sqrt(T) * z：随机波动部分（模拟市场情绪、突发事件等）
                # np.exp()：因为股价变化是百分比（涨跌10%），需要用指数函数计算
                # z：标准正态分布随机数，模拟市场不确定性
                # ST：到期时的股票指数水平

hT = np.maximum(ST - K, 0) 
                # 到期时，期权价值 = 股价 - 行权价（如果为负则归零）,
                # 商业直觉：如果1年后股价ST=120，期权值120-105=15元
                # 如果ST=90，期权值0（你不会用105元去买市场价90元的股票）

C0 = math.exp(-r * T) * np.mean(hT) 
                # 把未来收益的平均值，按利率折现到今天,为什么取平均值？
                # 10万次模拟中，有的赚钱有的亏钱，np.mean(hT)是统计"平均能赚多少"。
                # 为什么折现？ 1年后的15元 ≠ 今天的15元（如果存银行，今天约14.29元 ≈ 1年后15元）

print('Value of the European call option: {:5.3f}.'.format(C0)) # 输出结果
                # 输出示例：假设结果是8.021
                # 表示这个"未来以105元买茅台的权利"现在值约8.02元（权利金）


# 输出：Value of the European call option: 8.019.


# 我：帮我详细讲解以上金融量化领域相关的代码操作，让我这个没学过高数和统计学，
# 仅有一般散户金融知识、python基础（但金融、商业嗅觉灵敏）的小卡拉米也能非常明白

# deepseek：

'''
好的！我用最通俗的语言，结合商业和金融直觉，帮你拆解这段代码。即使没有高数和统计学基础，你也能完全理解。

---

### **这段代码在做什么？**
**目标：计算一个欧式看涨期权（European Call Option）的合理价格**  
（就像估算一个"未来买股票的权利"值多少钱）

---

### **1. 金融概念比喻**
- **股票现价（S0）**：当前股价是100元（比如茅台股票现在100元/股）。
- **行权价（K）**：约定1年后能以105元买入这支股票的权利（如果1年后股价涨到120元，你赚15元；如果跌到90元，你可以放弃权利，只损失权利金）。
- **无风险利率（r）**：假设存银行年利率5%（钱有时间价值，今天100元≈1年后105元）。
- **波动率（σ）**：股票价格的波动幅度20%（波动越大，期权越值钱，因为暴涨可能性更高）。

---

### **2. 代码逻辑分解**
#### **第一步：模拟未来股价（ST）**
```python
z = np.random.standard_normal(I)  # 生成10万个随机数（模拟市场不确定性）
ST = S0 * np.exp((r - sigma ** 2 / 2) * T + sigma * math.sqrt(T) * z)
```
- **为什么用随机数？**  
  没人能预测股价，但可以用统计学模拟"可能性"（比如抛硬币10万次，统计正面次数）。
- **公式解读**：  
  - `(r - sigma ** 2 / 2) * T`：股价长期趋势（利率影响 - 波动率调整）  
  - `sigma * math.sqrt(T) * z`：随机波动部分（模拟市场情绪、突发事件等）  
  - `np.exp()`：因为股价变化是百分比（涨跌10%），需要用指数函数计算。

#### **第二步：计算期权收益（hT）**
```python
hT = np.maximum(ST - K, 0)  # 到期时，期权价值 = 股价 - 行权价（如果为负则归零）
```
- **商业直觉**：  
  - 如果1年后股价`ST=120`，期权值`120-105=15元`  
  - 如果`ST=90`，期权值`0`（你不会用105元去买市场价90元的股票）

#### **第三步：折现求现值（C0）**
```python
C0 = math.exp(-r * T) * np.mean(hT)  # 把未来收益的平均值，按利率折现到今天
```
- **为什么取平均值？**  
  10万次模拟中，有的赚钱有的亏钱，`np.mean(hT)`是统计"平均能赚多少"。
- **为什么折现？**  
  1年后的15元 ≠ 今天的15元（如果存银行，今天约14.29元 ≈ 1年后15元）。

---

### **3. 为什么这样算？（蒙特卡洛模拟）**
- **现实类比**：  
  就像你开奶茶店，想预测明年利润：  
  1. 模拟100万次可能的天气、竞争对手、经济情况...  
  2. 统计平均利润，再考虑通胀折算到今天。
- **金融意义**：  
  通过大量随机实验，逼近期权的真实价值（尤其适合复杂衍生品）。

---

### **4. 输出结果解读**
```python
print('Value of the European call option: {:5.3f}.'.format(C0))
```
- **输出示例**：假设结果是`8.021`  
  - 表示这个"未来以105元买茅台的权利"现在值约8.02元（权利金）。

---

### **5. 你的商业嗅觉能怎么用？**
- **波动率（σ）是关键**：  
  - 如果茅台波动率从20%升到30%，期权会涨价（波动越大，暴涨概率越高）。  
  - 这就是为什么财报前、政策不确定时期权更贵！
- **时间价值**：  
  - `T=2`年（更长时间）会比`T=1`年更贵（更多时间可能上涨）。
- **对冲风险**：  
  如果你持有茅台股票，可以**买入看跌期权**（Put）对冲下跌风险（类似保险）。

---

### **总结**
| 代码部分 | 金融含义 | 商业类比 |
|---------|---------|---------|
| `S0=100` | 当前股价 | 奶茶店今日估值 |
| `K=105` | 行权价 | 加盟费未来优惠价 |
| `ST=...` | 模拟未来股价 | 预测明年客流量 |
| `hT=max(...)` | 期权到期收益 | 加盟权是否执行 |
| `C0=...` | 期权现值 | 今天该付多少加盟定金 |

**核心思想**：用计算机暴力模拟所有可能的市场情况，算出期权的"公平价格"。
'''